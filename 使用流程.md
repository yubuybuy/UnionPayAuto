# 云闪付 Tweak - 使用流程

## 🚀 三步快速开始

### 方法一：自动部署（推荐）

运行一键部署脚本：

```bash
一键部署.bat
```

按照提示操作即可完成：
1. 启动服务器并获取 IP
2. 自动更新 Tweak.x 配置
3. 初始化 Git 并推送到 GitHub

### 方法二：手动步骤

#### 第一步：配置服务器地址

```bash
# 自动获取 IP 并更新配置
python 自动配置.py
```

或手动编辑 `Tweak.x` 第 44 行。

#### 第二步：推送到 GitHub

```bash
# 方式1：使用脚本
推送到GitHub.bat

# 方式2：手动命令
git init
git add .
git commit -m "Initial commit"
git remote add origin https://github.com/你的用户名/UnionPayAuto.git
git push -u origin main
```

#### 第三步：等待编译

1. 访问 GitHub 仓库的 Actions 页面
2. 等待编译完成（约 2-3 分钟）
3. 下载 UnionPayAuto-DEB.zip
4. 解压得到 .deb 文件

---

## 📱 安装到 iPhone

1. 将 .deb 传输到 iPhone（AirDrop 或其他方式）
2. 用 Filza 打开 .deb
3. 点击右上角"安装"
4. 重启云闪付 APP

---

## 🔧 运行 BHV 接收服务器

在电脑上运行：

```bash
# 方式1：使用脚本
启动服务器.bat

# 方式2：直接运行
python bhv_server.py
```

确保 iPhone 和电脑在同一 WiFi 网络。

---

## 🧪 测试

1. 确保服务器正在运行
2. 打开云闪付 APP
3. 尝试领取优惠券
4. 当出现滑动验证码时，Tweak 会自动捕获 bhv
5. 服务器控制台会显示接收到的数据

---

## 📂 辅助脚本说明

| 脚本 | 功能 |
|------|------|
| `一键部署.bat` | 全自动部署：配置IP → Git → 推送 |
| `自动配置.py` | 自动获取IP并更新Tweak.x配置 |
| `启动服务器.bat` | 快速启动BHV接收服务器 |
| `推送到GitHub.bat` | 快速提交并推送代码 |

---

## 🔄 修改代码后重新编译

```bash
# 1. 修改代码后运行
推送到GitHub.bat

# 2. 等待 GitHub Actions 编译完成

# 3. 下载新的 .deb 并重新安装
```

---

## 📊 查看捕获的 BHV

### 方法1：查看文件

- `bhv_captured.json` - 所有历史记录
- `latest_bhv.txt` - 最新的 bhv

### 方法2：通过浏览器

访问（替换为你的电脑IP）：

- http://192.168.1.100:8888/ - 首页
- http://192.168.1.100:8888/list - 所有记录
- http://192.168.1.100:8888/latest - 最新记录

---

## ❓ 常见问题

### 无法连接到服务器

1. 检查 iPhone 和电脑是否在同一 WiFi
2. 检查电脑防火墙（允许端口 8888）
3. 用 iPhone Safari 访问 http://你的IP:8888 测试

### Tweak 没有加载

1. 检查 .deb 是否安装成功
2. 重启云闪付 APP
3. 查看日志：`idevicesyslog | grep Tweak`

### Git 推送失败

1. 检查是否配置了 Git 用户名和邮箱：
   ```bash
   git config --global user.name "你的名字"
   git config --global user.email "你的邮箱"
   ```

2. 检查 GitHub 凭据是否正确

---

## 📚 详细文档

- [README.md](README.md) - 项目说明
- [GitHub编译指南.md](GitHub编译指南.md) - 详细编译说明
- [IPA逆向分析报告.md](IPA逆向分析报告.md) - 技术分析

---

## 💡 提示

- 服务器地址只需配置一次
- 每次修改代码后推送到 GitHub 会自动编译
- bhv 数据会自动保存到 JSON 文件
- 可以在浏览器中实时查看捕获的 bhv
