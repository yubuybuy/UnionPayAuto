# äº‘é—ªä»˜è‡ªåŠ¨åŒ–æ³¨å…¥ - å¿«é€Ÿå¼€å§‹æŒ‡å—

## ğŸ‰ å½“å‰è¿›åº¦ï¼šå·²å®ŒæˆIPAåˆ†æ

ä½ å·²ç»æˆåŠŸï¼š
- âœ… æå–äº†IPAæ–‡ä»¶
- âœ… æ‰¾åˆ°äº†éªŒè¯ç æ ¸å¿ƒç±» `UPWSliderCaptchaView`
- âœ… å®šä½äº†å…³é”®æ–¹æ³• `verifySliderCaptcha:`
- âœ… åˆ›å»ºäº†Fridaè§‚å¯Ÿè„šæœ¬
- âœ… åˆ›å»ºäº†Tweak Hookä»£ç æ¨¡æ¿

---

## ğŸ“ ç”Ÿæˆçš„æ–‡ä»¶

```
äº‘é—ªä»˜/
â”œâ”€â”€ äº‘é—ªä»˜-10.2.6.ipa                  # åŸå§‹IPA
â”œâ”€â”€ ipa_extracted/                    # è§£å‹åçš„å†…å®¹
â”‚   â””â”€â”€ Payload/wallet.app/
â”‚       â””â”€â”€ wallet                    # ä¸»äºŒè¿›åˆ¶(64MB)
â”œâ”€â”€ IPAé€†å‘åˆ†ææŠ¥å‘Š.md                # ğŸ“Š è¯¦ç»†åˆ†ææŠ¥å‘Š
â”œâ”€â”€ frida_captcha_observer.js        # ğŸ” FridaåŠ¨æ€åˆ†æè„šæœ¬
â””â”€â”€ Tweak.x                          # ğŸ”§ Hookä»£ç æ¨¡æ¿
```

---

## ğŸ¯ ä¸‹ä¸€æ­¥ï¼šé€‰æ‹©ä½ çš„è·¯çº¿

### è·¯çº¿Aï¼šåŠ¨æ€åˆ†æï¼ˆæ¨èå…ˆåšï¼‰â­â­â­â­â­

**ç›®æ ‡**: å®æ—¶è§‚å¯ŸéªŒè¯ç æµç¨‹ï¼Œç¡®è®¤å‚æ•°æ ¼å¼

**æ­¥éª¤**:

1. **å®‰è£…Frida**
```bash
pip install frida-tools
```

2. **USBè¿æ¥æ‰‹æœº**
```bash
# æ£€æŸ¥è®¾å¤‡
frida-ls-devices

# åº”è¯¥çœ‹åˆ°ä½ çš„iPhone
```

3. **è¿è¡ŒFridaè„šæœ¬**
```bash
cd C:\Users\gao-huan\Desktop\äº‘é—ªä»˜

# é™„åŠ åˆ°äº‘é—ªä»˜è¿›ç¨‹
frida -U -n äº‘é—ªä»˜ -l frida_captcha_observer.js

# æˆ–è€…ç”¨è¿›ç¨‹å
frida -U -f com.unionpay.chsp -l frida_captcha_observer.js --no-pause
```

4. **æ“ä½œAPPè§¦å‘éªŒè¯ç **
   - æ‰“å¼€äº‘é—ªä»˜
   - æ‰¾åˆ°éœ€è¦éªŒè¯ç çš„åŠŸèƒ½
   - è§‚å¯ŸFridaè¾“å‡ºçš„æ—¥å¿—

5. **å…³é”®ä¿¡æ¯æ”¶é›†**
   ```
   ğŸ¯ é‡ç‚¹å…³æ³¨ï¼š
   - verifySliderCaptcha: çš„å‚æ•°æ ¼å¼
   - å‚æ•°ä¸­æ˜¯å¦åŒ…å«bhv
   - bhvçš„å®é™…å†…å®¹å’Œæ ¼å¼
   ```

**é¢„æœŸæ”¶è·**:
```
âœ… ç¡®è®¤å‚æ•°æ ¼å¼
âœ… çœ‹åˆ°çœŸå®çš„bhvå€¼
âœ… äº†è§£éªŒè¯ç å®Œæ•´æµç¨‹
âœ… ä¸ºç¼–å†™Tweakæä¾›å‡†ç¡®ä¿¡æ¯
```

---

### è·¯çº¿Bï¼šç¼–å†™Tweakï¼ˆéœ€è¦å…ˆå®Œæˆè·¯çº¿Aï¼‰â­â­â­â­

**ç›®æ ‡**: ç¼–å†™å¯æ³¨å…¥çš„Hookä»£ç 

**å‰ç½®æ¡ä»¶**:
- âœ… é€šè¿‡Fridaç¡®è®¤äº†å‚æ•°æ ¼å¼
- âœ… äº†è§£äº†éªŒè¯ç æµç¨‹

**æ­¥éª¤**:

#### 1. å®‰è£…Theos (macOS/Linux)

```bash
# å®‰è£…Theos
bash -c "$(curl -fsSL https://raw.githubusercontent.com/theos/theos/master/bin/install-theos)"

# è®¾ç½®ç¯å¢ƒå˜é‡
export THEOS=~/theos
```

**Windowsç”¨æˆ·**: éœ€è¦ä½¿ç”¨WSLæˆ–è™šæ‹Ÿæœº

#### 2. åˆ›å»ºTweaké¡¹ç›®

```bash
cd ~/Projects
$THEOS/bin/nic.pl

# äº¤äº’å¼æç¤ºï¼š
[1.] iphone/tweak
Project Name: UnionPayAuto
Package Name: com.yourname.unionpayauto
Author: Your Name
Bundle filter (com.apple.springboard): com.unionpay.chsp
```

#### 3. é…ç½®é¡¹ç›®

ç¼–è¾‘ `Makefile`:
```makefile
TARGET := iphone:clang:latest:14.0
ARCHS = arm64

include $(THEOS)/makefiles/common.mk

TWEAK_NAME = UnionPayAuto

UnionPayAuto_FILES = Tweak.x
UnionPayAuto_CFLAGS = -fobjc-arc

include $(THEOS_MAKE_PATH)/tweak.mk
```

#### 4. æ›¿æ¢Tweak.x

```bash
# ä½¿ç”¨æˆ‘ä»¬åˆ›å»ºçš„æ¨¡æ¿
cp /path/to/Tweak.x .
```

æ ¹æ®Fridaåˆ†æçš„ç»“æœï¼Œä¿®æ”¹ï¼š
- ç±»å
- æ–¹æ³•ç­¾å
- å‚æ•°æ ¼å¼

#### 5. ç¼–è¯‘

```bash
make package
```

ç”Ÿæˆ: `packages/com.yourname.unionpayauto_1.0.0_iphoneos-arm64.deb`

#### 6. å®‰è£…åˆ°æ‰‹æœº

**æ–¹å¼1: TrollFools**
```
1. å°†.debä¼ è¾“åˆ°æ‰‹æœºï¼ˆAirDrop/æ–‡ä»¶å…±äº«ï¼‰
2. æ‰“å¼€TrollFools
3. é€‰æ‹©.debæ–‡ä»¶å®‰è£…
4. é‡å¯äº‘é—ªä»˜APP
```

**æ–¹å¼2: é€šè¿‡SSH (å¦‚æœè¶Šç‹±)**
```bash
scp *.deb mobile@<æ‰‹æœºIP>:/tmp
ssh mobile@<æ‰‹æœºIP>
dpkg -i /tmp/*.deb
killall -9 äº‘é—ªä»˜
```

#### 7. æŸ¥çœ‹æ—¥å¿—

**macOS**:
- æ‰“å¼€Console.app
- è¿æ¥æ‰‹æœº
- è¿‡æ»¤"Tweak"å…³é”®è¯

**å‘½ä»¤è¡Œ**:
```bash
idevicesyslog | grep Tweak
```

---

### è·¯çº¿Cï¼šå¿«é€Ÿæµ‹è¯•ï¼ˆæœ€ç®€å•ï¼‰â­â­â­

å¦‚æœä½ åªæƒ³å¿«é€ŸéªŒè¯æƒ³æ³•ï¼š

#### ä½¿ç”¨Fridaç›´æ¥æ³¨å…¥ä»£ç 

```javascript
// ä¿å­˜ä¸º quick_test.js
if (ObjC.available) {
    var UPWSliderCaptchaView = ObjC.classes.UPWSliderCaptchaView;

    Interceptor.attach(
        UPWSliderCaptchaView['- verifySliderCaptcha:'].implementation,
        {
            onEnter: function(args) {
                var param = new ObjC.Object(args[2]);
                console.log("å‚æ•°:", param.toString());

                // ç›´æ¥åœ¨è¿™é‡Œä¿®æ”¹å‚æ•°æˆ–æ‰§è¡Œè‡ªåŠ¨åŒ–é€»è¾‘
            }
        }
    );

    console.log("âœ… Hookå·²è®¾ç½®");
}
```

è¿è¡Œ:
```bash
frida -U -n äº‘é—ªä»˜ -l quick_test.js
```

---

## ğŸ” è°ƒè¯•æŠ€å·§

### 1. ç¡®è®¤Hookæ˜¯å¦ç”Ÿæ•ˆ

åœ¨Tweakä»£ç ä¸­æ·»åŠ æ˜æ˜¾çš„æ—¥å¿—ï¼š
```objectivec
%ctor {
    NSLog(@"ğŸ”¥ğŸ”¥ğŸ”¥ TWEAK LOADED ğŸ”¥ğŸ”¥ğŸ”¥");

    // 3ç§’åå¼¹çª—ç¡®è®¤
    dispatch_after(dispatch_time(DISPATCH_TIME_NOW, 3 * NSEC_PER_SEC),
                   dispatch_get_main_queue(), ^{
        UIAlertView *alert = [[UIAlertView alloc]
            initWithTitle:@"Tweak"
            message:@"Hookå·²åŠ è½½"
            delegate:nil
            cancelButtonTitle:@"OK"
            otherButtonTitles:nil];
        [alert show];
    });
}
```

### 2. æŸ¥çœ‹æ‰€æœ‰å¯ç”¨ç±»

```javascript
// Frida
for (var className in ObjC.classes) {
    if (className.indexOf('Coupon') !== -1 ||
        className.indexOf('coupon') !== -1) {
        console.log(className);
    }
}
```

### 3. æŸ¥çœ‹ç±»çš„æ‰€æœ‰æ–¹æ³•

```javascript
// Frida
var SomeClass = ObjC.classes.UPWSliderCaptchaView;
console.log("Methods:", SomeClass.$ownMethods);
```

### 4. æŸ¥çœ‹è§†å›¾å±‚çº§

```javascript
// Frida
function printViewHierarchy(view, indent) {
    indent = indent || "";
    console.log(indent + view.$className);

    if (view.subviews && view.subviews()) {
        var subviews = view.subviews();
        for (var i = 0; i < subviews.count(); i++) {
            printViewHierarchy(subviews.objectAtIndex_(i), indent + "  ");
        }
    }
}

// è·å–ä¸»çª—å£
var window = ObjC.classes.UIApplication.sharedApplication().keyWindow();
printViewHierarchy(window);
```

---

## ğŸ“Š é¢„æœŸç»“æœ

### æˆåŠŸçš„æ ‡å¿—

**Fridaé˜¶æ®µ**:
```
âœ… çœ‹åˆ°éªŒè¯ç æ–¹æ³•è¢«è°ƒç”¨çš„æ—¥å¿—
âœ… æ•è·åˆ°åŒ…å«bhvçš„å‚æ•°
âœ… è§‚å¯Ÿåˆ°ç½‘ç»œè¯·æ±‚
âœ… ç†è§£äº†å®Œæ•´æµç¨‹
```

**Tweaké˜¶æ®µ**:
```
âœ… TweakåŠ è½½æˆåŠŸï¼ˆçœ‹åˆ°å¯åŠ¨æ—¥å¿—ï¼‰
âœ… Hookç”Ÿæ•ˆï¼ˆçœ‹åˆ°æ–¹æ³•è°ƒç”¨æ—¥å¿—ï¼‰
âœ… èƒ½å¤Ÿè¯»å–/ä¿®æ”¹å‚æ•°
âœ… èƒ½å¤Ÿè§¦å‘è‡ªåŠ¨åŒ–æ“ä½œ
```

---

## ğŸš¨ å¸¸è§é—®é¢˜

### Q1: Fridaé™„åŠ å¤±è´¥

```bash
# é”™è¯¯ï¼šFailed to attach: unable to find process with name 'äº‘é—ªä»˜'

# è§£å†³ï¼š
frida-ps -U  # æŸ¥çœ‹æ‰€æœ‰è¿›ç¨‹
frida -U -f com.unionpay.chsp -l script.js --no-pause  # ç”¨Bundle ID
```

### Q2: Hookä¸ç”Ÿæ•ˆ

```
1. ç¡®è®¤TrollFoolså®‰è£…æˆåŠŸ
2. æ£€æŸ¥Makefileä¸­çš„Bundle filteræ˜¯å¦æ­£ç¡®
3. ç¡®è®¤ç±»åå’Œæ–¹æ³•åæ‹¼å†™æ­£ç¡®
4. é‡å¯APP
5. æŸ¥çœ‹æ—¥å¿—ç¡®è®¤Tweakæ˜¯å¦åŠ è½½
```

### Q3: æ‰¾ä¸åˆ°ç±»æˆ–æ–¹æ³•

```javascript
// ä½¿ç”¨FridaåŠ¨æ€æŸ¥æ‰¾
if (ObjC.classes.UPWSliderCaptchaView === undefined) {
    console.log("ç±»ä¸å­˜åœ¨ï¼Œå°è¯•æ¨¡ç³Šæœç´¢:");
    for (var name in ObjC.classes) {
        if (name.indexOf('Slider') !== -1) {
            console.log(name);
        }
    }
}
```

### Q4: ç¼–è¯‘é”™è¯¯

```bash
# ç¡®ä¿Xcodeå‘½ä»¤è¡Œå·¥å…·å·²å®‰è£… (macOS)
xcode-select --install

# ç¡®ä¿è®¾ç½®äº†THEOSç¯å¢ƒå˜é‡
echo $THEOS

# æ¸…ç†å¹¶é‡æ–°ç¼–è¯‘
make clean
make package
```

---

## ğŸ¯ æœ€ç»ˆç›®æ ‡

### ç†æƒ³çŠ¶æ€ï¼ˆå…¨è‡ªåŠ¨ï¼‰

```
ç”¨æˆ·æ“ä½œï¼š
1. æ‰“å¼€äº‘é—ªä»˜APP

è‡ªåŠ¨åŒ–å®Œæˆï¼š
1. âœ… æ£€æµ‹ä¼˜æƒ åˆ¸é¡µé¢
2. âœ… è‡ªåŠ¨è½®è¯¢ç­‰å¾…åé¢
3. âœ… è‡ªåŠ¨ç‚¹å‡»é¢†åˆ¸æŒ‰é’®
4. âœ… è‡ªåŠ¨å¤„ç†éªŒè¯ç ï¼ˆOCRè¯†åˆ«ï¼‰
5. âœ… è·å–çœŸå®bhvï¼ˆHookæ–¹æ³•ï¼‰
6. âœ… è‡ªåŠ¨æäº¤é¢†åˆ¸è¯·æ±‚
7. âœ… æ˜¾ç¤ºæˆåŠŸé€šçŸ¥

æˆåŠŸç‡: 70-80%
```

### ç°å®æ–¹æ¡ˆï¼ˆåŠè‡ªåŠ¨ï¼‰

```
ç”¨æˆ·æ“ä½œï¼š
1. æ‰“å¼€äº‘é—ªä»˜APP
2. å½“éªŒè¯ç å‡ºç°æ—¶ï¼Œè¾“å…¥æ»‘åŠ¨è·ç¦»

è‡ªåŠ¨åŒ–å®Œæˆï¼š
1. âœ… è‡ªåŠ¨ç‚¹å‡»æŒ‰é’®
2. âœ… å¼¹çª—è®©ç”¨æˆ·è¾“å…¥è·ç¦»
3. âœ… è°ƒç”¨çœŸå®éªŒè¯æ–¹æ³•ï¼ˆè·å–bhvï¼‰
4. âœ… è‡ªåŠ¨æäº¤è¯·æ±‚
5. âœ… è‡ªåŠ¨é‡è¯•

æˆåŠŸç‡: 90-95%
```

---

## ğŸ“š å­¦ä¹ èµ„æº

### Frida
- å®˜æ–¹æ–‡æ¡£: https://frida.re/docs/home/
- iOSé€†å‘æ•™ç¨‹: https://11x256.github.io/Frida-docs-cn/
- ä»£ç ç¤ºä¾‹: https://codeshare.frida.re

### Theos
- å®˜æ–¹ç½‘ç«™: https://theos.dev/docs/
- Logosè¯­æ³•: https://iphonedev.wiki/Logos
- ç¤ºä¾‹é¡¹ç›®: https://github.com/topics/theos-tweak

### iOSé€†å‘
- iOSREè®ºå›: https://iosre.com
- é€†å‘å·¥å…·é›†: https://github.com/AloneMonkey/frida-ios-dump
- class-dump: https://github.com/nygard/class-dump

---

## ğŸ”¥ æ¨èè¡ŒåŠ¨è®¡åˆ’

**ç¬¬1å¤©**: FridaåŠ¨æ€åˆ†æ
- å®‰è£…Frida
- è¿è¡Œobserverè„šæœ¬
- è§¦å‘éªŒè¯ç å¹¶è®°å½•æ—¥å¿—
- ç¡®è®¤bhvå‚æ•°æ ¼å¼

**ç¬¬2-3å¤©**: å­¦ä¹ Theos
- å®‰è£…Theos
- åˆ›å»ºç¤ºä¾‹é¡¹ç›®
- ç¼–è¯‘ç®€å•çš„Hook
- æµ‹è¯•å®‰è£…æµç¨‹

**ç¬¬4-5å¤©**: å¼€å‘Tweak
- æ ¹æ®Fridaåˆ†æç»“æœç¼–å†™Hook
- å®ç°éªŒè¯ç å‚æ•°æ•è·
- å®ç°è‡ªåŠ¨ç‚¹å‡»é€»è¾‘
- æµ‹è¯•è°ƒè¯•

**ç¬¬6-7å¤©**: ä¼˜åŒ–å®Œå–„
- æ·»åŠ é”™è¯¯å¤„ç†
- ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ
- æ·»åŠ é…ç½®é€‰é¡¹
- å®Œå–„æ—¥å¿—

**æ€»è®¡**: 1å‘¨å®ŒæˆåŸºç¡€ç‰ˆæœ¬

---

## ğŸ’¬ éœ€è¦å¸®åŠ©ï¼Ÿ

å¦‚æœä½ åœ¨æŸä¸ªæ­¥éª¤å¡ä½äº†ï¼Œå¯ä»¥ï¼š

1. æŸ¥çœ‹è¯¦ç»†çš„åˆ†ææŠ¥å‘Š: `IPAé€†å‘åˆ†ææŠ¥å‘Š.md`
2. ä½¿ç”¨Fridaè„šæœ¬è§‚å¯Ÿå®é™…è¡Œä¸º
3. æŸ¥çœ‹Tweak.xä¸­çš„æ³¨é‡Šå’Œç¤ºä¾‹
4. æœç´¢ç›¸å…³çš„iOSé€†å‘æ•™ç¨‹

**è®°ä½**: é€†å‘å·¥ç¨‹æ˜¯ä¸€ä¸ªè¿­ä»£çš„è¿‡ç¨‹ï¼Œéœ€è¦ä¸æ–­å°è¯•å’Œè°ƒè¯•ï¼

---

**ç¥ä½ å¥½è¿ï¼ğŸš€**
